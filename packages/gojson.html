<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Go encoding/json Deep Guide</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  background: #0d0d0f;
  color: #f5f5f7;
  padding: 60px 30px;
  line-height: 1.7;
}

.container {
  max-width: 900px;
  margin: auto;
}

.topbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 40px;
}

h1 { font-weight: 600; }
h2 { margin-top: 60px; font-weight: 500; }

.code-box {
  font-family: Menlo, monospace;
  background: #0b1a14;
  padding: 18px;
  border-radius: 8px;
  margin: 20px 0;
  white-space: pre;
  overflow-x: auto;
  font-size: 0.95rem;
}

.keyword { color: #ff453a; }
.type { color: #4da3ff; }
.string { color: #30d158; }
.number { color: #bf5af2; }
.muted { color: #999; }

table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
}
td, th {
  border-bottom: 1px solid rgba(255,255,255,0.1);
  padding: 8px;
}
</style>

</head>
<body>

<div class="container">

<div class="topbar">
  <h1>Go encoding/json — Deep Guide</h1>
</div>

<p class="muted">
Complete backend-level reference for Go JSON handling.
</p>

<h2>1. json.Marshal()</h2>

<p>
Converts a Go value → JSON text (returned as <span class="type">[]byte</span>).
</p>

<div class="code-box">
type User struct {
  ID   int    `json:"id"`
  Name string `json:"name"`
}

u := User{ID: 1, Name: "Rak"}

jsonBytes, err := json.Marshal(u)
</div>

<p>
Output:
</p>

<div class="code-box">
{"id":1,"name":"Rak"}
</div>

<p>
Internally:
</p>

<table>
<tr><th>Go Type</th><th>JSON Output</th></tr>
<tr><td>int</td><td>number</td></tr>
<tr><td>string</td><td>string</td></tr>
<tr><td>bool</td><td>true/false</td></tr>
<tr><td>slice</td><td>array</td></tr>
<tr><td>map</td><td>object</td></tr>
</table>

---

<h2>2. json.Unmarshal()</h2>

<p>
Converts JSON text → Go struct.
Requires pointer.
</p>

<div class="code-box">
var u User
err := json.Unmarshal(jsonBytes, &u)
</div>

<p>
If JSON type mismatches Go type → error.
</p>

Example error:
</p>

<div class="code-box">
json: cannot unmarshal string into Go struct field User.ID of type int
</div>

---

<h2>3. json.NewDecoder()</h2>

<p>
Used for reading JSON from a stream (HTTP body, file, socket).
</p>

<div class="code-box">
err := json.NewDecoder(req.Body).Decode(&u)
</div>

<p>
Used in HTTP handlers.
</p>

Example full handler:
</p>

<div class="code-box">
func handleUser(res http.ResponseWriter, req *http.Request) {

  var input User

  err := json.NewDecoder(req.Body).Decode(&input)
  if err != nil {
    res.WriteHeader(400)
    return
  }

}
</div>

---

<h2>4. json.NewEncoder()</h2>

<p>
Used to write JSON directly to HTTP response.
</p>

<div class="code-box">
res.Header().Set("Content-Type", "application/json")
json.NewEncoder(res).Encode(u)
</div>

<p>
This automatically:
</p>

- Marshals struct  
- Writes JSON to response  
- Adds newline  

---

<h2>5. json.MarshalIndent()</h2>

<p>
Pretty prints JSON.
</p>

<div class="code-box">
pretty, _ := json.MarshalIndent(u, "", "  ")
fmt.Println(string(pretty))
</div>

Output:
</div>

<div class="code-box">
{
  "id": 1,
  "name": "Rak"
}
</div>

---

<h2>6. Struct Tags</h2>

<div class="code-box">
ID int `json:"user_id"`
</div>

<p>
Changes JSON key name.
</p>

Without tag:
</p>

<div class="code-box">
{"ID":1}
</div>

With tag:
</div>

<div class="code-box">
{"user_id":1}
</div>

---

<h2>7. omitempty</h2>

<div class="code-box">
Name string `json:"name,omitempty"`
</div>

If empty string → field removed.

Example:
</div>

<div class="code-box">
User{ID:1, Name:""} → {"id":1}
</div>

---

<h2>8. json:"-"</h2>

<div class="code-box">
Password string `json:"-"`
</div>

Never appears in JSON.
Used for:
- Password hash
- Internal fields

---

<h2>9. ,string modifier</h2>

<div class="code-box">
ID int `json:"id,string"`
</div>

Allows this JSON:

<div class="code-box">
{"id":"200"}
</div>

Converts string → int automatically.

---

<h2>10. map[string]any</h2>

<div class="code-box">
var data map[string]any
json.Unmarshal(jsonBytes, &data)
</div>

Important:

All numbers become float64.

<div class="code-box">
age := data["age"].(float64)
</div>

Use struct instead for strict typing.

---

<h2>11. Zero Values</h2>

<table>
<tr><th>Type</th><th>Zero Value</th></tr>
<tr><td>int</td><td>0</td></tr>
<tr><td>string</td><td>""</td></tr>
<tr><td>bool</td><td>false</td></tr>
<tr><td>slice</td><td>nil</td></tr>
<tr><td>map</td><td>nil</td></tr>
</table>

Missing JSON field → zero value.

---

<h2>12. Slices & null vs []</h2>

<div class="code-box">
type T struct {
  Tags []string `json:"tags"`
}
</div>

Case 1:
</div>

<div class="code-box">
T{Tags:nil} → {"tags":null}
</div>

Case 2:
</div>

<div class="code-box">
T{Tags:[]string{}} → {"tags":[]}
</div>

Difference matters in APIs.

---

<h2>13. DisallowUnknownFields()</h2>

<div class="code-box">
decoder := json.NewDecoder(req.Body)
decoder.DisallowUnknownFields()
err := decoder.Decode(&u)
</div>

Rejects unexpected keys.
Used in production APIs.

---

<h2>14. Exported Fields Only</h2>

<div class="code-box">
type User struct {
  ID int
  name string
}
</div>

name ignored because lowercase.

---

<h2>15. Duplicate Keys</h2>

<div class="code-box">
{"id":1,"id":2}
</div>

Result:
</div>

<div class="code-box">
ID = 2
</div>

Last wins.

---

<h2>16. Nested Struct</h2>

<div class="code-box">
type Profile struct {
  Age int `json:"age"`
}

type User struct {
  ID int `json:"id"`
  Profile Profile `json:"profile"`
}
</div>

JSON:
</div>

<div class="code-box">
{
  "id":1,
  "profile":{"age":21}
}
</div>

---

<h2>17. Summary Mental Model</h2>

<table>
<tr><th>JSON</th><th>Go</th></tr>
<tr><td>object</td><td>struct / map</td></tr>
<tr><td>array</td><td>slice</td></tr>
<tr><td>string</td><td>string</td></tr>
<tr><td>number</td><td>int/float64</td></tr>
<tr><td>true/false</td><td>bool</td></tr>
</table>

---

<p class="muted" style="text-align: center;">
 &#169;Rakshith
</p>

</div>
</body>
</html>